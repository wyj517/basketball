import{_ as Q,r as s,h as Y,i as ee,j as ae,c as D,o as B,d as n,w as r,e as $,u as te,b as t,t as o,g as v,F,f as J,n as O}from"./index-C1EvLQdv.js";const le={class:"background"},se={style:{color:"#00bcd4","font-weight":"bold"}},oe={style:{margin:"20px 0"},class:"center"},ne={class:"box-font"},re={class:"box-font"},ue={class:"main-time"},ie={style:{"margin-top":"10px"}},ce={class:"small-timer"},ve={class:"small-time"},de={class:"source-board"},me={class:"team"},pe={class:"team-name"},fe={class:"team-source"},ye={class:"team-panel"},_e={class:"player-list"},ge=["onClick"],be={class:"player-name"},ke={class:"player-score"},Ce={class:"team"},Te={class:"team-name"},Se={class:"team-source"},we={class:"team-panel"},he={class:"player-list"},Ne=["onClick"],De={class:"player-name"},Be={class:"player-score"},Re={class:"score-controls"},$e={__name:"second",setup(Ie){const K=ee(),I=te(),P=s("wa"),p=s(null),i=s({name:"XX1队",players:[]}),c=s({name:"XX2队",players:[]}),b=s({totalPeriods:4,periodTime:12,breakTime:2}),C=s(1),f=s("playing"),y=s(0),_=s(12*60);let R=null;const k=s(24),T=s(0),S=s(0);s([]),s([]);const w=s(1),u=s(0);Y(()=>{const a=K.query.data;if(a)try{p.value=JSON.parse(a),p.value.teamA&&(i.value=p.value.teamA,i.value.players=i.value.players.map(e=>({...e,score:0}))),p.value.teamB&&(c.value=p.value.teamB,c.value.players=c.value.players.map(e=>({...e,score:0}))),p.value.settings&&(b.value=p.value.settings,_.value=b.value.periodTime*60),p.value.matchName&&(P.value=p.value.matchName)}catch(e){console.error("解析数据失败:",e)}window.addEventListener("keydown",E)}),ae(()=>{window.removeEventListener("keydown",E)});function z(a){const e=String(Math.floor(a/60)).padStart(2,"0"),l=String(a%60).padStart(2,"0");return`${e}:${l}`}function U(){R||(R=setInterval(()=>{if(f.value==="playing"){if(_.value>0)_.value--;else if(_.value===0){N(),j();return}if(k.value>0)k.value--;else if(k.value===0){N(),confirm("24秒违例！点击确定继续比赛并重置24秒计时器。")&&X();return}}else f.value==="resting"&&(y.value>0?y.value--:y.value===0&&(N(),L()));d()},1e3))}function N(){clearInterval(R),R=null,d()}function M(){U(),d()}function V(){N(),f.value="playing",_.value=b.value.periodTime*60,y.value=0,d()}function X(){k.value=24,d()}function x(a,e){w.value=a,u.value=e}function h(a){w.value===1?(T.value+=a,i.value.players[u.value]&&(i.value.players[u.value].score+=a)):(S.value+=a,c.value.players[u.value]&&(c.value.players[u.value].score+=a))}function A(){w.value===1&&T.value>0?(T.value--,i.value.players[u.value]&&i.value.players[u.value].score>0&&i.value.players[u.value].score--):w.value===2&&S.value>0&&(S.value--,c.value.players[u.value]&&c.value.players[u.value].score>0&&c.value.players[u.value].score--)}function j(){f.value="resting",y.value=b.value.breakTime*60,d()}function L(){C.value<b.value.totalPeriods&&(C.value++,f.value="playing",_.value=b.value.periodTime*60,y.value=0,k.value=24,d())}function E(a){if(!(a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"))switch(a.key.toLowerCase()){case"1":case"enter":a.preventDefault(),h(1),d();break;case"2":a.preventDefault(),h(2),d();break;case"3":a.preventDefault(),h(3),d();break;case"z":(a.ctrlKey||a.metaKey||!a.ctrlKey&&!a.metaKey)&&(a.preventDefault(),A(),d());break}}function d(){try{const a={teamA:{name:i.value.name,score:T.value},teamB:{name:c.value.name,score:S.value},playNumber:C.value,mainTime:_.value,smallTime:k.value,restTime:y.value,gameStatus:f.value,settings:b.value},e=new URL(window.location);e.hash=`/competition?data=${encodeURIComponent(JSON.stringify(a))}`,window.history.replaceState(null,"",e.toString()),localStorage.setItem("matchSyncData",JSON.stringify(a));try{const l=new BroadcastChannel("matchDataChannel");l.postMessage({type:"dataUpdated",data:a}),l.close()}catch{console.log("BroadcastChannel not supported")}}catch(a){console.error("更新URL参数和localStorage失败:",a)}}function q(){I.push("/")}function H(){try{const a={teamA:{name:i.value.name,score:T.value},teamB:{name:c.value.name,score:S.value},playNumber:C.value,mainTime:_.value,smallTime:k.value,restTime:y.value,gameStatus:f.value};localStorage.setItem("matchSyncData",JSON.stringify(a)),window.open(`#/test?data=${encodeURIComponent(JSON.stringify(a))}`,"_blank")}catch(a){console.error("打开test页面失败:",a),I.push({path:"/test",query:{data:encodeURIComponent(JSON.stringify(syncData))}})}}return(a,e)=>{const l=$("el-button"),W=$("el-card"),Z=$("el-container");return B(),D("div",le,[n(Z,{style:{height:"100vh","justify-content":"center","align-items":"center"}},{default:r(()=>[n(W,{class:"box-card"},{default:r(()=>[t("div",se,o(P.value),1),t("div",oe,[e[11]||(e[11]=t("span",{class:"box-font"},"第",-1)),t("span",ne,o(C.value),1),t("span",re,o(f.value==="resting"?"节休息":"节比赛"),1),t("div",ue,o(z(f.value==="resting"?y.value:_.value)),1),t("div",ie,[n(l,{type:"primary",onClick:U},{default:r(()=>[...e[4]||(e[4]=[v("开始",-1)])]),_:1}),n(l,{type:"warning",onClick:N},{default:r(()=>[...e[5]||(e[5]=[v("暂停",-1)])]),_:1}),n(l,{type:"primary",onClick:M},{default:r(()=>[...e[6]||(e[6]=[v("继续",-1)])]),_:1}),n(l,{type:"danger",onClick:V},{default:r(()=>[...e[7]||(e[7]=[v("重置",-1)])]),_:1}),n(l,{type:"success",onClick:L,disabled:C.value>=b.value.totalPeriods},{default:r(()=>[...e[8]||(e[8]=[v(" 下一节 ",-1)])]),_:1},8,["disabled"])]),t("div",ce,[e[10]||(e[10]=t("span",{class:"small-label"},"24秒:",-1)),t("span",ve,o(k.value)+"秒",1),n(l,{size:"large",type:"warning",onClick:X,style:{color:"#000"}},{default:r(()=>[...e[9]||(e[9]=[v(" 重置24秒 ",-1)])]),_:1})])]),t("div",de,[t("div",me,[t("div",pe,[t("p",null,o(i.value.name||"XX1队"),1)]),t("div",fe,o(T.value),1),t("div",ye,[t("div",_e,[(B(!0),D(F,null,J(i.value.players,(m,g)=>(B(),D("button",{key:g,class:O(["player-btn",{active:w.value===1&&u.value===g}]),tabindex:"0",onClick:G=>x(1,g)},[t("div",null,o(m.number||g+1),1),t("div",be,o(m.name),1),t("div",ke,o(m.score||0),1)],10,ge))),128))])])]),t("div",Ce,[t("div",Te,[t("p",null,o(c.value.name||"XX2队"),1)]),t("div",Se,o(S.value),1),t("div",we,[t("div",he,[(B(!0),D(F,null,J(c.value.players,(m,g)=>(B(),D("button",{key:g,class:O(["player-btn",{active:w.value===2&&u.value===g}]),tabindex:"0",onClick:G=>x(2,g)},[t("div",null,o(m.number||g+1),1),t("div",De,o(m.name),1),t("div",Be,o(m.score||0),1)],10,Ne))),128))])])])]),t("div",Re,[n(l,{color:"#4CAF50",onClick:e[0]||(e[0]=m=>h(1))},{default:r(()=>[...e[12]||(e[12]=[v("1分 (Enter/1)",-1)])]),_:1}),n(l,{color:"#FF9800",onClick:e[1]||(e[1]=m=>h(2))},{default:r(()=>[...e[13]||(e[13]=[v("2分 (2)",-1)])]),_:1}),n(l,{color:"#2196F3",onClick:e[2]||(e[2]=m=>h(3))},{default:r(()=>[...e[14]||(e[14]=[v("3分 (3)",-1)])]),_:1}),n(l,{type:"danger",onClick:e[3]||(e[3]=m=>A())},{default:r(()=>[...e[15]||(e[15]=[v("撤销 (Z)",-1)])]),_:1}),n(l,{type:"primary",onClick:H},{default:r(()=>[...e[16]||(e[16]=[v("打开test页面",-1)])]),_:1}),n(l,{onClick:q},{default:r(()=>[...e[17]||(e[17]=[v("返回首页",-1)])]),_:1})])]),_:1})]),_:1})])}}},Ue=Q($e,[["__scopeId","data-v-ba25ac0d"]]);export{Ue as default};
