import{_ as Q}from"./jiantou-D-2Ruc_p.js";import{_ as ge,r as c,h as be,i as _e,j as ke,c as k,o as g,d,w as v,e as O,u as we,b as t,t as u,k as F,l as Se,g as m,n as R,m as Y,F as ee,f as ae,p as le,q as te,s as se}from"./index-C4xfRVK2.js";import{u as z,w as Ce}from"./xlsx-CKN5doRT.js";const Te={class:"background"},he={style:{color:"#00bcd4","font-weight":"bold"}},Pe={style:{margin:"20px 0"},class:"center"},xe={class:"box-font"},De={class:"box-font"},Be={class:"main-time"},Ae={style:{"margin-top":"10px"}},Ne={key:0,class:"small-timer"},Ie={class:"small-time"},$e={class:"source-board"},Ee={class:"team-name"},Fe={style:{"margin-top":"0"}},Re={class:"team-source"},Ue={style:{"font-size":"clamp(16px, 3vw, 24px)",color:"#ffd05e",margin:"8px 0"}},Le={class:"team-panel"},Oe={class:"player-list"},ze=["onClick"],Je={class:"player-name"},Me={class:"player-score"},je={key:0,class:"player-foul"},Ke={class:"team-name"},Xe={style:{"margin-top":"0"}},Ve={class:"team-source"},qe={style:{"font-size":"clamp(16px, 3vw, 24px)",color:"#ffd05e",margin:"8px 0"}},Ge={class:"team-panel"},He={class:"player-list"},We=["onClick"],Ze={class:"player-name"},Qe={class:"player-score"},Ye={key:0,class:"player-foul"},ea={class:"score-controls"},aa={__name:"second",setup(la){const D=c(!0),ne=_e(),J=we(),M=c("wa"),p=c(null),r=c({name:"XX1队",players:[]}),o=c({name:"XX2队",players:[]}),y=c({totalPeriods:4,periodTime:12,breakTime:2,enable24Seconds:!0}),I=c(0),$=c(0),T=c(!0),C=c(!0);function oe(){D.value=!D.value,f();try{const a=new BroadcastChannel("matchDataChannel");a.postMessage({type:"possessionChanged",jiantou:D.value}),a.close()}catch{}}const h=c(1),n=c("playing"),b=c(0),w=c(12*60);let E=null;const S=c(24),B=c(0),A=c(0);c([]),c([]);const _=c(1),i=c(0);be(()=>{const a=ne.query.data;if(a)try{p.value=JSON.parse(a),p.value.teamA&&(r.value=p.value.teamA,r.value.players=r.value.players.map(e=>({...e,score:0,foul:0}))),p.value.teamB&&(o.value=p.value.teamB,o.value.players=o.value.players.map(e=>({...e,score:0,foul:0}))),p.value.teamAPauses!==void 0&&(I.value=p.value.teamAPauses),p.value.teamBPauses!==void 0&&($.value=p.value.teamBPauses),p.value.settings&&(y.value=p.value.settings,w.value=y.value.periodTime*60),p.value.matchName&&(M.value=p.value.matchName)}catch(e){console.error("解析数据失败:",e)}window.addEventListener("keydown",W)}),ke(()=>{window.removeEventListener("keydown",W)});function ue(a){const e=String(Math.floor(a/60)).padStart(2,"0"),s=String(a%60).padStart(2,"0");return`${e}:${s}`}function j(){confirm("确定要开始比赛吗？")&&(E||(n.value==="ready"&&(n.value="playing"),E=setInterval(()=>{if(n.value==="playing"){if(w.value>0)w.value--;else if(w.value===0){P(),h.value>=y.value.totalPeriods?(n.value="ended",b.value=0):ve();return}if(y.value.enable24Seconds){if(S.value>0)S.value--;else if(S.value===0){P(),confirm("24秒违例！点击确定继续比赛并重置24秒计时器。")&&K();return}}}else n.value==="resting"&&(b.value>0?b.value--:b.value===0&&(P(),U()));f()},1e3)))}function P(){clearInterval(E),E=null,f()}function re(){j(),f()}function ie(){P(),n.value="playing",w.value=y.value.periodTime*60,b.value=0,f()}function K(){S.value=24,f()}function X(a,e){_.value=a,i.value=e}function V(a){a===1?I.value++:$.value++,P(),f()}function N(a){_.value===1?(B.value+=a,r.value.players[i.value]&&(r.value.players[i.value].score+=a)):(A.value+=a,o.value.players[i.value]&&(o.value.players[i.value].score+=a)),y.value.enable24Seconds&&(S.value=24),f()}function q(){_.value===1&&r.value.players[i.value]?r.value.players[i.value].foul+=1:_.value===2&&o.value.players[i.value]&&(o.value.players[i.value].foul+=1),f()}function G(){_.value===1&&r.value.players[i.value]&&r.value.players[i.value].foul>0?r.value.players[i.value].foul-=1:_.value===2&&o.value.players[i.value]&&o.value.players[i.value].foul>0&&(o.value.players[i.value].foul-=1),f()}function H(){_.value===1&&B.value>0?(B.value--,r.value.players[i.value]&&r.value.players[i.value].score>0&&r.value.players[i.value].score--):_.value===2&&A.value>0&&(A.value--,o.value.players[i.value]&&o.value.players[i.value].score>0&&o.value.players[i.value].score--)}function ve(){n.value="resting",b.value=y.value.breakTime*60,f()}function U(){h.value<y.value.totalPeriods&&(h.value++,n.value="ready",w.value=y.value.periodTime*60,b.value=0,S.value=24,P(),f())}function W(a){if(!(a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"))switch(a.key.toLowerCase()){case"1":a.preventDefault(),N(1);break;case"2":case"enter":a.preventDefault(),N(2);break;case"3":a.preventDefault(),N(3);break;case"f":a.preventDefault(),q();break;case"g":a.preventDefault(),G();break;case"z":(a.ctrlKey||a.metaKey||!a.ctrlKey&&!a.metaKey)&&(a.preventDefault(),H());break}}function f(){try{const a={teamA:{name:r.value.name,score:B.value,players:r.value.players},teamB:{name:o.value.name,score:A.value,players:o.value.players},teamAPauses:I.value,teamBPauses:$.value,jiantou:D.value,playNumber:h.value,mainTime:w.value,smallTime:S.value,restTime:b.value,gameStatus:n.value,settings:y.value},e=new URL(window.location);e.hash=`/competition?data=${encodeURIComponent(JSON.stringify(a))}`,window.history.replaceState(null,"",e.toString()),localStorage.setItem("matchSyncData",JSON.stringify(a));try{const s=new BroadcastChannel("matchDataChannel");s.postMessage({type:"dataUpdated",data:a}),s.close()}catch{}}catch(a){console.error("更新URL参数和localStorage失败:",a)}}function de(){confirm("确定要结束比赛吗？结束后将返回首页。")&&J.push("/")}function ce(){try{const a=[];a.push(["队伍","号码","姓名","得分","犯规次数"]),r.value.players.forEach(l=>{a.push([r.value.name||"A队",l.number,l.name||"",l.score||0,l.foul||0])}),o.value.players.forEach(l=>{a.push([o.value.name||"B队",l.number,l.name||"",l.score||0,l.foul||0])});const e=z.aoa_to_sheet(a),s=z.book_new();z.book_append_sheet(s,e,"比赛数据");const L=`比赛数据_${new Date().toISOString().replace(/[:.]/g,"-")}.xlsx`;Ce(s,L),console.log("Excel导出成功")}catch(a){console.error("Excel导出失败:",a),alert("Excel导出失败，请重试")}}function me(){T.value=!T.value;try{const a=new BroadcastChannel("matchDataChannel");a.postMessage({type:"toggleTeamPanels",show:T.value}),a.close()}catch{localStorage.setItem("showTeamPanels",T.value.toString())}}function pe(){try{const a={teamA:{name:r.value.name,score:B.value,players:r.value.players},teamB:{name:o.value.name,score:A.value,players:o.value.players},teamAPauses:I.value,teamBPauses:$.value,playNumber:h.value,mainTime:w.value,smallTime:S.value,restTime:b.value,gameStatus:n.value,showTeamPanels:T.value,swap:C.value};localStorage.setItem("matchSyncData",JSON.stringify(a)),localStorage.setItem("showTeamPanels",T.value.toString()),localStorage.setItem("swap",C.value.toString()),window.open(`#/test?data=${encodeURIComponent(JSON.stringify(a))}`,"_blank")}catch(a){console.error("打开test页面失败:",a),J.push({path:"/test",query:{data:encodeURIComponent(JSON.stringify(syncData))}})}}function fe(){C.value=!C.value;try{const a=new BroadcastChannel("matchDataChannel");a.postMessage({type:"swapTeams",swapped:C.value}),a.close()}catch{localStorage.setItem("swap",C.value.toString())}f()}return(a,e)=>{const s=O("el-button"),Z=O("el-card"),L=O("el-container");return g(),k("div",Te,[d(L,{style:{height:"100vh","justify-content":"center","align-items":"center"}},{default:v(()=>[d(Z,{class:"box-card"},{default:v(()=>[t("div",he,u(M.value),1),t("div",Pe,[e[17]||(e[17]=t("span",{class:"box-font"},"第",-1)),t("span",xe,u(h.value),1),t("span",De,u(n.value==="resting"?"节休息":n.value==="ended"?"节比赛结束":n.value==="ready"?"节准备开始":"节比赛"),1),t("div",Be,u(ue(n.value==="resting"?b.value:w.value)),1),t("div",Ae,[d(s,{type:"primary",onClick:j},{default:v(()=>[...e[9]||(e[9]=[m("开始",-1)])]),_:1}),d(s,{type:"warning",onClick:P},{default:v(()=>[...e[10]||(e[10]=[m("暂停",-1)])]),_:1}),d(s,{type:"primary",onClick:re},{default:v(()=>[...e[11]||(e[11]=[m("继续",-1)])]),_:1}),d(s,{type:"danger",onClick:ie},{default:v(()=>[...e[12]||(e[12]=[m("重置",-1)])]),_:1}),d(s,{type:"success",onClick:U,disabled:h.value>=y.value.totalPeriods||n.value==="ended"},{default:v(()=>[...e[13]||(e[13]=[m(" 下一节 ",-1)])]),_:1},8,["disabled"]),n.value==="resting"?(g(),Se(s,{key:0,type:"info",onClick:U},{default:v(()=>[...e[14]||(e[14]=[m(" 提前结束休息 ",-1)])]),_:1})):F("",!0)]),y.value.enable24Seconds&&n.value==="playing"?(g(),k("div",Ne,[e[16]||(e[16]=t("span",{class:"small-label"},"24秒:",-1)),t("span",Ie,u(S.value)+"秒",1),d(s,{size:"large",type:"warning",onClick:K,style:{color:"#000"},disabled:n.value!=="playing"},{default:v(()=>[...e[15]||(e[15]=[m(" 重置24秒 ",-1)])]),_:1},8,["disabled"])])):F("",!0)]),t("div",$e,[t("div",{class:"team",style:R({order:C.value?1:2})},[t("div",Ee,[t("img",{src:Q,alt:"箭头",style:R({opacity:D.value?1:0})},null,4),t("p",Fe,u(r.value.name||"A队"),1)]),t("div",Re,u(String(B.value).padStart(2,"0")),1),t("div",Ue,u(r.value.players.filter(l=>l.foul>0).length)+" 犯 / "+u(I.value)+" 暂停 ",1),t("div",Le,[Y((g(),k("div",Oe,[(g(!0),k(ee,null,ae(r.value.players,(l,x)=>(g(),k("button",{key:x,class:le(["player-btn",{active:_.value===1&&i.value===x}]),tabindex:"0",onClick:ye=>X(1,x),draggable:"true"},[t("div",null,u(l.number),1),t("div",Je,u(l.name||l.number+"号球员"),1),t("div",Me,u(String(l.score||0).padStart(1,"0")),1),l.foul>0?(g(),k("div",je,u(l.foul)+" 犯",1)):F("",!0)],10,ze))),128))])),[[te(se),{list:o.value.players,canDrag:!0,dragItemClass:"player-btn"}]])])],4),t("div",{class:"team",style:R({order:C.value?2:1})},[t("div",Ke,[t("img",{src:Q,alt:"箭头",style:R({opacity:D.value?0:1})},null,4),t("p",Xe,u(o.value.name||"B队"),1)]),t("div",Ve,u(String(A.value).padStart(2,"0")),1),t("div",qe,u(o.value.players.filter(l=>l.foul>0).length)+" 犯 / "+u($.value)+" 暂停 ",1),t("div",Ge,[Y((g(),k("div",He,[(g(!0),k(ee,null,ae(o.value.players,(l,x)=>(g(),k("button",{key:x,class:le(["player-btn",{active:_.value===2&&i.value===x}]),tabindex:"0",onClick:ye=>X(2,x),draggable:"true"},[t("div",null,u(l.number),1),t("div",Ze,u(l.name||l.number+"号球员"),1),t("div",Qe,u(l.score||0),1),l.foul>0?(g(),k("div",Ye,u(l.foul)+" 犯",1)):F("",!0)],10,We))),128))])),[[te(se),{list:o.value.players,canDrag:!0,dragItemClass:"player-btn"}]])])],4)]),t("div",ea,[d(s,{color:"#4CAF50",onClick:e[0]||(e[0]=l=>N(1)),disabled:n.value==="ended"},{default:v(()=>[...e[18]||(e[18]=[m("1分 (1)",-1)])]),_:1},8,["disabled"]),d(s,{color:"#FF9800",onClick:e[1]||(e[1]=l=>N(2)),disabled:n.value==="ended"},{default:v(()=>[...e[19]||(e[19]=[m("2分 (Enter/2)",-1)])]),_:1},8,["disabled"]),d(s,{color:"#2196F3",onClick:e[2]||(e[2]=l=>N(3)),disabled:n.value==="ended"},{default:v(()=>[...e[20]||(e[20]=[m("3分 (3)",-1)])]),_:1},8,["disabled"]),d(s,{type:"danger",onClick:e[3]||(e[3]=l=>H()),disabled:n.value==="ended"},{default:v(()=>[...e[21]||(e[21]=[m("撤销分数 (Z)",-1)])]),_:1},8,["disabled"]),d(s,{type:"warning",onClick:e[4]||(e[4]=l=>q()),disabled:n.value==="ended"},{default:v(()=>[...e[22]||(e[22]=[m("犯规 (F)",-1)])]),_:1},8,["disabled"]),d(s,{type:"warning",onClick:e[5]||(e[5]=l=>G()),disabled:n.value==="ended"},{default:v(()=>[...e[23]||(e[23]=[m("撤销犯规 (G)",-1)])]),_:1},8,["disabled"]),d(s,{type:"primary",onClick:e[6]||(e[6]=l=>V(1)),disabled:n.value==="ended"},{default:v(()=>[m(u(r.value.name||"A队")+"暂停 ",1)]),_:1},8,["disabled"]),d(s,{type:"primary",onClick:e[7]||(e[7]=l=>V(2)),disabled:n.value==="ended"},{default:v(()=>[m(u(o.value.name||"B队")+"暂停 ",1)]),_:1},8,["disabled"]),d(s,{type:"primary",onClick:me},{default:v(()=>[m(u(T.value?"隐藏":"显示")+"人员面板 ",1)]),_:1}),d(s,{type:"warning",onClick:fe},{default:v(()=>[...e[24]||(e[24]=[m("换边",-1)])]),_:1}),d(s,{color:"#8E24AA",onClick:oe},{default:v(()=>[...e[25]||(e[25]=[m("切换球权",-1)])]),_:1}),d(s,{type:"primary",onClick:pe},{default:v(()=>[...e[26]||(e[26]=[m("打开副屏",-1)])]),_:1}),d(s,{type:"success",onClick:e[8]||(e[8]=l=>ce())},{default:v(()=>[...e[27]||(e[27]=[m("导出Excel数据",-1)])]),_:1}),d(s,{color:"#D32F2F",onClick:de},{default:v(()=>[...e[28]||(e[28]=[m("结束比赛",-1)])]),_:1})])]),_:1})]),_:1})])}}},oa=ge(aa,[["__scopeId","data-v-36815225"]]);export{oa as default};
