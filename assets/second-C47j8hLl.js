import{_ as pe,r as c,h as fe,i as ye,j as ge,c as T,o as w,d,w as v,e as J,u as be,b as s,t as r,k as O,l as ke,g as m,F as le,f as te,n as se}from"./index-D8lsJf-2.js";import{u as z,w as _e}from"./xlsx-CKN5doRT.js";const Se={class:"background"},we={style:{color:"#00bcd4","font-weight":"bold"}},Te={style:{margin:"20px 0"},class:"center"},Ce={class:"box-font"},De={class:"box-font"},Pe={class:"main-time"},xe={style:{"margin-top":"10px"}},Be={key:0,class:"small-timer"},Ae={class:"small-time"},he={class:"source-board"},Ne={class:"team"},Ee={class:"team-name"},$e={class:"team-source"},Ie={style:{"font-size":"clamp(16px, 3vw, 24px)",color:"#ffd05e",margin:"8px 0"}},Fe={class:"team-panel"},Re=["onClick","onDragstart"],Oe={class:"player-name"},Ue={class:"player-score"},Le={key:0,class:"player-foul"},Je={class:"team"},ze={class:"team-name"},Ke={class:"team-source"},Xe={style:{"font-size":"clamp(16px, 3vw, 24px)",color:"#ffd05e",margin:"8px 0"}},Me={class:"team-panel"},Ve=["onClick","onDragstart"],je={class:"player-name"},qe={class:"player-score"},Ge={key:0,class:"player-foul"},He={class:"score-controls"},We={__name:"second",setup(Ze){const ne=ye(),K=be(),X=c("wa"),f=c(null),o=c({name:"XX1队",players:[]}),u=c({name:"XX2队",players:[]}),y=c({totalPeriods:4,periodTime:12,breakTime:2,enable24Seconds:!0}),$=c(0),I=c(0),C=c(!0),D=c(1),n=c("playing"),b=c(0),_=c(12*60);let F=null;const S=c(24),B=c(0),A=c(0);c([]),c([]);const k=c(1),i=c(0);fe(()=>{const a=ne.query.data;if(a)try{f.value=JSON.parse(a),f.value.teamA&&(o.value=f.value.teamA,o.value.players=o.value.players.map(e=>({...e,score:0,foul:0}))),f.value.teamB&&(u.value=f.value.teamB,u.value.players=u.value.players.map(e=>({...e,score:0,foul:0}))),f.value.teamAPauses!==void 0&&($.value=f.value.teamAPauses),f.value.teamBPauses!==void 0&&(I.value=f.value.teamBPauses),f.value.settings&&(y.value=f.value.settings,_.value=y.value.periodTime*60),f.value.matchName&&(X.value=f.value.matchName)}catch(e){console.error("解析数据失败:",e)}window.addEventListener("keydown",Z)}),ge(()=>{window.removeEventListener("keydown",Z)});function oe(a){const e=String(Math.floor(a/60)).padStart(2,"0"),t=String(a%60).padStart(2,"0");return`${e}:${t}`}function M(){confirm("确定要开始比赛吗？")&&(F||(n.value==="ready"&&(n.value="playing"),F=setInterval(()=>{if(n.value==="playing"){if(_.value>0)_.value--;else if(_.value===0){P(),D.value>=y.value.totalPeriods?(n.value="ended",b.value=0):ie();return}if(y.value.enable24Seconds){if(S.value>0)S.value--;else if(S.value===0){P(),confirm("24秒违例！点击确定继续比赛并重置24秒计时器。")&&V();return}}}else n.value==="resting"&&(b.value>0?b.value--:b.value===0&&(P(),U()));g()},1e3)))}function P(){clearInterval(F),F=null,g()}function ue(){M(),g()}function re(){P(),n.value="playing",_.value=y.value.periodTime*60,b.value=0,g()}function V(){S.value=24,g()}function j(a,e){k.value=a,i.value=e}function q(a){a===1?$.value++:I.value++,P(),g()}function h(a){k.value===1?(B.value+=a,o.value.players[i.value]&&(o.value.players[i.value].score+=a)):(A.value+=a,u.value.players[i.value]&&(u.value.players[i.value].score+=a)),y.value.enable24Seconds&&(S.value=24),g()}function G(){k.value===1&&o.value.players[i.value]?o.value.players[i.value].foul+=1:k.value===2&&u.value.players[i.value]&&(u.value.players[i.value].foul+=1),g()}function H(){k.value===1&&o.value.players[i.value]&&o.value.players[i.value].foul>0?o.value.players[i.value].foul-=1:k.value===2&&u.value.players[i.value]&&u.value.players[i.value].foul>0&&(u.value.players[i.value].foul-=1),g()}function W(){k.value===1&&B.value>0?(B.value--,o.value.players[i.value]&&o.value.players[i.value].score>0&&o.value.players[i.value].score--):k.value===2&&A.value>0&&(A.value--,u.value.players[i.value]&&u.value.players[i.value].score>0&&u.value.players[i.value].score--)}function ie(){n.value="resting",b.value=y.value.breakTime*60,g()}function U(){D.value<y.value.totalPeriods&&(D.value++,n.value="ready",_.value=y.value.periodTime*60,b.value=0,S.value=24,P(),g())}function Z(a){if(!(a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"))switch(a.key.toLowerCase()){case"1":a.preventDefault(),h(1);break;case"2":case"enter":a.preventDefault(),h(2);break;case"3":a.preventDefault(),h(3);break;case"f":a.preventDefault(),G();break;case"g":a.preventDefault(),H();break;case"z":(a.ctrlKey||a.metaKey||!a.ctrlKey&&!a.metaKey)&&(a.preventDefault(),W());break}}function g(){try{const a={teamA:{name:o.value.name,score:B.value,players:o.value.players},teamB:{name:u.value.name,score:A.value,players:u.value.players},teamAPauses:$.value,teamBPauses:I.value,playNumber:D.value,mainTime:_.value,smallTime:S.value,restTime:b.value,gameStatus:n.value,settings:y.value},e=new URL(window.location);e.hash=`/competition?data=${encodeURIComponent(JSON.stringify(a))}`,window.history.replaceState(null,"",e.toString()),localStorage.setItem("matchSyncData",JSON.stringify(a));try{const t=new BroadcastChannel("matchDataChannel");t.postMessage({type:"dataUpdated",data:a}),t.close()}catch{}}catch(a){console.error("更新URL参数和localStorage失败:",a)}}function ve(){confirm("确定要结束比赛吗？结束后将返回首页。")&&K.push("/")}function de(){try{const a=[];a.push(["队伍","号码","姓名","得分","犯规次数"]),o.value.players.forEach(l=>{a.push([o.value.name||"A队",l.number,l.name||"",l.score||0,l.foul||0])}),u.value.players.forEach(l=>{a.push([u.value.name||"B队",l.number,l.name||"",l.score||0,l.foul||0])});const e=z.aoa_to_sheet(a),t=z.book_new();z.book_append_sheet(t,e,"比赛数据");const E=`比赛数据_${new Date().toISOString().replace(/[:.]/g,"-")}.xlsx`;_e(t,E),console.log("Excel导出成功")}catch(a){console.error("Excel导出失败:",a),alert("Excel导出失败，请重试")}}let R=null,L=null;function Q(a,e,t){R=t,L=e,a.dataTransfer.effectAllowed="move",setTimeout(()=>{a.target.style.opacity="0.5"},0)}function Y(a,e){a.preventDefault(),a.dataTransfer.dropEffect="move"}function ee(a,e){a.preventDefault();const t=a.target.closest(".player-btn");t&&(t.style.opacity="1");const N=a.target.closest(".player-btn");if(!N||L!==e)return;const E=Array.from(N.parentElement.children).indexOf(N);if(R===E)return;const p=[...(e==="A"?o.value:u.value).players],[x]=p.splice(R,1);p.splice(E,0,x),e==="A"?o.value.players=p:u.value.players=p,g()}function ae(a){a.target.style.opacity="1",R=null,L=null}function ce(){C.value=!C.value;try{const a=new BroadcastChannel("matchDataChannel");a.postMessage({type:"toggleTeamPanels",show:C.value}),a.close()}catch{localStorage.setItem("showTeamPanels",C.value.toString())}}function me(){try{const a={teamA:{name:o.value.name,score:B.value,players:o.value.players},teamB:{name:u.value.name,score:A.value,players:u.value.players},teamAPauses:$.value,teamBPauses:I.value,playNumber:D.value,mainTime:_.value,smallTime:S.value,restTime:b.value,gameStatus:n.value,showTeamPanels:C.value};localStorage.setItem("matchSyncData",JSON.stringify(a)),localStorage.setItem("showTeamPanels",C.value.toString()),window.open(`#/test?data=${encodeURIComponent(JSON.stringify(a))}`,"_blank")}catch(a){console.error("打开test页面失败:",a),K.push({path:"/test",query:{data:encodeURIComponent(JSON.stringify(syncData))}})}}return(a,e)=>{const t=J("el-button"),N=J("el-card"),E=J("el-container");return w(),T("div",Se,[d(E,{style:{height:"100vh","justify-content":"center","align-items":"center"}},{default:v(()=>[d(N,{class:"box-card"},{default:v(()=>[s("div",we,r(X.value),1),s("div",Te,[e[21]||(e[21]=s("span",{class:"box-font"},"第",-1)),s("span",Ce,r(D.value),1),s("span",De,r(n.value==="resting"?"节休息":n.value==="ended"?"节比赛结束":n.value==="ready"?"节准备开始":"节比赛"),1),s("div",Pe,r(oe(n.value==="resting"?b.value:_.value)),1),s("div",xe,[d(t,{type:"primary",onClick:M},{default:v(()=>[...e[13]||(e[13]=[m("开始",-1)])]),_:1}),d(t,{type:"warning",onClick:P},{default:v(()=>[...e[14]||(e[14]=[m("暂停",-1)])]),_:1}),d(t,{type:"primary",onClick:ue},{default:v(()=>[...e[15]||(e[15]=[m("继续",-1)])]),_:1}),d(t,{type:"danger",onClick:re},{default:v(()=>[...e[16]||(e[16]=[m("重置",-1)])]),_:1}),d(t,{type:"success",onClick:U,disabled:D.value>=y.value.totalPeriods||n.value==="ended"},{default:v(()=>[...e[17]||(e[17]=[m(" 下一节 ",-1)])]),_:1},8,["disabled"]),n.value==="resting"?(w(),ke(t,{key:0,type:"info",onClick:U},{default:v(()=>[...e[18]||(e[18]=[m(" 提前结束休息 ",-1)])]),_:1})):O("",!0)]),y.value.enable24Seconds&&n.value==="playing"?(w(),T("div",Be,[e[20]||(e[20]=s("span",{class:"small-label"},"24秒:",-1)),s("span",Ae,r(S.value)+"秒",1),d(t,{size:"large",type:"warning",onClick:V,style:{color:"#000"},disabled:n.value!=="playing"},{default:v(()=>[...e[19]||(e[19]=[m(" 重置24秒 ",-1)])]),_:1},8,["disabled"])])):O("",!0)]),s("div",he,[s("div",Ne,[s("div",Ee,[s("p",null,r(o.value.name||"A队"),1)]),s("div",$e,r(String(B.value).padStart(2,"0")),1),s("div",Ie,r(o.value.players.filter(l=>l.foul>0).length)+" 犯 / "+r($.value)+" 暂停",1),s("div",Fe,[s("div",{class:"player-list",onDragover:e[0]||(e[0]=l=>Y(l,"A")),onDrop:e[1]||(e[1]=l=>ee(l,"A"))},[(w(!0),T(le,null,te(o.value.players,(l,p)=>(w(),T("button",{key:p,class:se(["player-btn",{active:k.value===1&&i.value===p}]),tabindex:"0",onClick:x=>j(1,p),draggable:"true",onDragstart:x=>Q(x,"A",p),onDragend:ae},[s("div",null,r(l.number),1),s("div",Oe,r(l.name||l.number+"号球员"),1),s("div",Ue,r(String(l.score||0).padStart(1,"0")),1),l.foul>0?(w(),T("div",Le,r(l.foul)+" 犯",1)):O("",!0)],42,Re))),128))],32)])]),s("div",Je,[s("div",ze,[s("p",null,r(u.value.name||"B队"),1)]),s("div",Ke,r(String(A.value).padStart(2,"0")),1),s("div",Xe,r(u.value.players.filter(l=>l.foul>0).length)+" 犯 / "+r(I.value)+" 暂停",1),s("div",Me,[s("div",{class:"player-list",onDragover:e[2]||(e[2]=l=>Y(l,"B")),onDrop:e[3]||(e[3]=l=>ee(l,"B"))},[(w(!0),T(le,null,te(u.value.players,(l,p)=>(w(),T("button",{key:p,class:se(["player-btn",{active:k.value===2&&i.value===p}]),tabindex:"0",onClick:x=>j(2,p),draggable:"true",onDragstart:x=>Q(x,"B",p),onDragend:ae},[s("div",null,r(l.number),1),s("div",je,r(l.name||l.number+"号球员"),1),s("div",qe,r(l.score||0),1),l.foul>0?(w(),T("div",Ge,r(l.foul)+" 犯",1)):O("",!0)],42,Ve))),128))],32)])])]),s("div",He,[d(t,{color:"#4CAF50",onClick:e[4]||(e[4]=l=>h(1)),disabled:n.value==="ended"},{default:v(()=>[...e[22]||(e[22]=[m("1分 (1)",-1)])]),_:1},8,["disabled"]),d(t,{color:"#FF9800",onClick:e[5]||(e[5]=l=>h(2)),disabled:n.value==="ended"},{default:v(()=>[...e[23]||(e[23]=[m("2分 (Enter/2)",-1)])]),_:1},8,["disabled"]),d(t,{color:"#2196F3",onClick:e[6]||(e[6]=l=>h(3)),disabled:n.value==="ended"},{default:v(()=>[...e[24]||(e[24]=[m("3分 (3)",-1)])]),_:1},8,["disabled"]),d(t,{type:"danger",onClick:e[7]||(e[7]=l=>W()),disabled:n.value==="ended"},{default:v(()=>[...e[25]||(e[25]=[m("撤销分数 (Z)",-1)])]),_:1},8,["disabled"]),d(t,{type:"warning",onClick:e[8]||(e[8]=l=>G()),disabled:n.value==="ended"},{default:v(()=>[...e[26]||(e[26]=[m("犯规 (F)",-1)])]),_:1},8,["disabled"]),d(t,{type:"warning",onClick:e[9]||(e[9]=l=>H()),disabled:n.value==="ended"},{default:v(()=>[...e[27]||(e[27]=[m("撤销犯规 (G)",-1)])]),_:1},8,["disabled"]),d(t,{type:"primary",onClick:e[10]||(e[10]=l=>q(1)),disabled:n.value==="ended"},{default:v(()=>[m(r(o.value.name||"A队")+"暂停 ",1)]),_:1},8,["disabled"]),d(t,{type:"primary",onClick:e[11]||(e[11]=l=>q(2)),disabled:n.value==="ended"},{default:v(()=>[m(r(u.value.name||"B队")+"暂停 ",1)]),_:1},8,["disabled"]),d(t,{type:"success",onClick:e[12]||(e[12]=l=>de())},{default:v(()=>[...e[28]||(e[28]=[m("导出Excel数据",-1)])]),_:1}),d(t,{type:"primary",onClick:ce},{default:v(()=>[m(r(C.value?"隐藏":"显示")+"人员面板 ",1)]),_:1}),d(t,{type:"primary",onClick:me},{default:v(()=>[...e[29]||(e[29]=[m("打开副屏",-1)])]),_:1}),d(t,{onClick:ve},{default:v(()=>[...e[30]||(e[30]=[m("结束比赛",-1)])]),_:1})])]),_:1})]),_:1})])}}},ea=pe(We,[["__scopeId","data-v-b641fe03"]]);export{ea as default};
