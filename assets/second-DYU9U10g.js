import{_ as ge,r as c,j as be,k as _e,l as we,c as w,o as b,d,w as v,e as O,u as Se,b as s,t as u,h as K,m as ke,g as m,n as Ce,p as L,i as Q,F as Y,f as ee,q as ae,s as le,x as te}from"./index-Bo0ycN9C.js";import{_ as se}from"./jiantou-Bvhfw6dr.js";import{u as z,w as he}from"./xlsx-CKN5doRT.js";const Te={class:"background"},Pe={style:{color:"#00bcd4","font-weight":"bold"}},xe={style:{margin:"20px 0"},class:"center"},Be={class:"box-font"},De={class:"box-font"},Ae={class:"main-time"},Ne={style:{"margin-top":"10px"}},Ie={key:0,class:"small-timer"},$e={class:"small-time"},Ee={class:"source-board"},Fe={class:"team-name"},Re={style:{"margin-top":"0"}},Ue={class:"team-source"},Ke={style:{"font-size":"clamp(16px, 3vw, 24px)",color:"#ffd05e",margin:"8px 0"}},Le={class:"team-panel"},Me={class:"player-list"},Oe=["onClick"],ze={class:"player-name"},Je={class:"player-score"},je={key:0,class:"player-foul"},Xe={class:"team-name"},Ve={style:{"margin-top":"0"}},qe={class:"team-source"},Ge={style:{"font-size":"clamp(16px, 3vw, 24px)",color:"#ffd05e",margin:"8px 0"}},He={class:"team-panel"},We={class:"player-list"},Ze=["onClick"],Qe={class:"player-name"},Ye={class:"player-score"},ea={key:0,class:"player-foul"},aa={class:"score-controls"},la={__name:"second",setup(ta){const A=c(!0),ne=_e(),J=Se(),j=c("wa"),p=c(null),r=c({name:"XX1队",players:[]}),o=c({name:"XX2队",players:[]}),y=c({totalPeriods:4,periodTime:12,breakTime:2,enable24Seconds:!0}),$=c(0),E=c(0),P=c(!0),C=c(!0);function oe(){A.value=!A.value,f();try{const a=new BroadcastChannel("matchDataChannel");a.postMessage({type:"possessionChanged",jiantou:A.value}),a.close()}catch{}}const x=c(1),n=c("playing"),_=c(0),S=c(12*60);let R=null;const k=c(24),h=c(0),T=c(0);c([]),c([]);const g=c(1),i=c(0);be(()=>{const a=ne.query.data;if(a)try{p.value=JSON.parse(a),p.value.teamA&&(r.value=p.value.teamA,r.value.players=r.value.players.map(e=>({...e,score:0,foul:0}))),p.value.teamB&&(o.value=p.value.teamB,o.value.players=o.value.players.map(e=>({...e,score:0,foul:0}))),p.value.teamAPauses!==void 0&&($.value=p.value.teamAPauses),p.value.teamBPauses!==void 0&&(E.value=p.value.teamBPauses),p.value.settings&&(y.value=p.value.settings,S.value=y.value.periodTime*60),p.value.matchName&&(j.value=p.value.matchName)}catch(e){console.error("解析数据失败:",e)}window.addEventListener("keydown",Z)}),we(()=>{window.removeEventListener("keydown",Z)});function ue(a){const e=String(Math.floor(a/60)).padStart(2,"0"),t=String(a%60).padStart(2,"0");return`${e}:${t}`}function X(){confirm("确定要开始比赛吗？")&&(R||(n.value==="ready"&&(n.value="playing"),R=setInterval(()=>{if(n.value==="playing"){if(S.value>0)S.value--;else if(S.value===0){B(),x.value>=y.value.totalPeriods?(n.value="ended",_.value=0):ve();return}if(y.value.enable24Seconds){if(k.value>0)k.value--;else if(k.value===0){B(),confirm("24秒违例！点击确定继续比赛并重置24秒计时器。")&&U();return}}}else n.value==="resting"&&(_.value>0?_.value--:_.value===0&&(B(),M()));f()},1e3)))}function B(){clearInterval(R),R=null,f()}function re(){X(),f()}function ie(){B(),n.value="playing",S.value=y.value.periodTime*60,_.value=0,f()}function U(){k.value=24,f()}function V(a,e){g.value=a,i.value=e}function q(a){a===1?$.value++:E.value++,B(),f()}function N(a){const e=h.value,t=T.value;g.value===1?(h.value+=a,r.value.players[i.value]&&(r.value.players[i.value].score+=a)):(T.value+=a,o.value.players[i.value]&&(o.value.players[i.value].score+=a)),y.value.enable24Seconds&&(k.value=24),f();try{const I=new BroadcastChannel("matchDataChannel"),F={type:"scoreAdded",team:g.value,points:a,oldScoreA:e,oldScoreB:t,newScoreA:h.value,newScoreB:T.value};I.postMessage(F),I.close()}catch{}}function G(){g.value===1&&r.value.players[i.value]?r.value.players[i.value].foul+=1:g.value===2&&o.value.players[i.value]&&(o.value.players[i.value].foul+=1),f()}function H(){g.value===1&&r.value.players[i.value]&&r.value.players[i.value].foul>0?r.value.players[i.value].foul-=1:g.value===2&&o.value.players[i.value]&&o.value.players[i.value].foul>0&&(o.value.players[i.value].foul-=1),f()}function W(){g.value===1&&h.value>0?(h.value--,r.value.players[i.value]&&r.value.players[i.value].score>0&&r.value.players[i.value].score--):g.value===2&&T.value>0&&(T.value--,o.value.players[i.value]&&o.value.players[i.value].score>0&&o.value.players[i.value].score--)}function ve(){n.value="resting",_.value=y.value.breakTime*60,f()}function M(){x.value<y.value.totalPeriods&&(x.value++,n.value="ready",S.value=y.value.periodTime*60,_.value=0,k.value=24,B(),f())}function Z(a){if(!(a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"))switch(a.key.toLowerCase()){case"1":a.preventDefault(),N(1);break;case"2":case"enter":a.preventDefault(),N(2);break;case"3":a.preventDefault(),N(3);break;case"f":a.preventDefault(),G();break;case"g":a.preventDefault(),H();break;case"z":(a.ctrlKey||a.metaKey||!a.ctrlKey&&!a.metaKey)&&(a.preventDefault(),W());break;case" ":a.preventDefault(),U();break}}function f(){try{const a={teamA:{name:r.value.name,score:h.value,players:r.value.players},teamB:{name:o.value.name,score:T.value,players:o.value.players},teamAPauses:$.value,teamBPauses:E.value,jiantou:A.value,playNumber:x.value,mainTime:S.value,smallTime:k.value,restTime:_.value,gameStatus:n.value,settings:y.value},e=new URL(window.location);e.hash=`/competition?data=${encodeURIComponent(JSON.stringify(a))}`,window.history.replaceState(null,"",e.toString()),localStorage.setItem("matchSyncData",JSON.stringify(a));try{const t=new BroadcastChannel("matchDataChannel");t.postMessage({type:"dataUpdated",data:a}),t.close()}catch{}}catch(a){console.error("更新URL参数和localStorage失败:",a)}}function de(){confirm("确定要结束比赛吗？结束后将返回首页。")&&J.push("/")}function ce(){try{const a=[];a.push(["队伍","号码","姓名","得分","犯规次数"]),r.value.players.forEach(l=>{a.push([r.value.name||"A队",l.number,l.name||"",l.score||0,l.foul||0])}),o.value.players.forEach(l=>{a.push([o.value.name||"B队",l.number,l.name||"",l.score||0,l.foul||0])});const e=z.aoa_to_sheet(a),t=z.book_new();z.book_append_sheet(t,e,"比赛数据");const F=`比赛数据_${new Date().toISOString().replace(/[:.]/g,"-")}.xlsx`;he(t,F),console.log("Excel导出成功")}catch(a){console.error("Excel导出失败:",a),alert("Excel导出失败，请重试")}}function me(){P.value=!P.value;try{const a=new BroadcastChannel("matchDataChannel");a.postMessage({type:"toggleTeamPanels",show:P.value}),a.close()}catch{localStorage.setItem("showTeamPanels",P.value.toString())}}function pe(){try{const a={teamA:{name:r.value.name,score:h.value,players:r.value.players},teamB:{name:o.value.name,score:T.value,players:o.value.players},teamAPauses:$.value,teamBPauses:E.value,playNumber:x.value,mainTime:S.value,smallTime:k.value,restTime:_.value,gameStatus:n.value,showTeamPanels:P.value,swap:C.value};localStorage.setItem("matchSyncData",JSON.stringify(a)),localStorage.setItem("showTeamPanels",P.value.toString()),localStorage.setItem("swap",C.value.toString()),window.open(`#/test?data=${encodeURIComponent(JSON.stringify(a))}`,"_blank")}catch(a){console.error("打开test页面失败:",a),J.push({path:"/test",query:{data:encodeURIComponent(JSON.stringify(syncData))}})}}function fe(){C.value=!C.value;try{const a=new BroadcastChannel("matchDataChannel");a.postMessage({type:"swapTeams",swapped:C.value}),a.close()}catch{localStorage.setItem("swap",C.value.toString())}f()}return(a,e)=>{const t=O("el-button"),I=O("el-card"),F=O("el-container");return b(),w("div",Te,[d(F,{style:{height:"100vh","justify-content":"center","align-items":"center"}},{default:v(()=>[d(I,{class:"box-card"},{default:v(()=>[s("div",Pe,u(j.value),1),s("div",xe,[e[17]||(e[17]=s("span",{class:"box-font"},"第",-1)),s("span",Be,u(x.value),1),s("span",De,u(n.value==="resting"?"节休息":n.value==="ended"?"节比赛结束":n.value==="ready"?"节准备开始":"节比赛"),1),s("div",Ae,u(ue(n.value==="resting"?_.value:S.value)),1),s("div",Ne,[d(t,{type:"primary",onClick:X},{default:v(()=>[...e[9]||(e[9]=[m("开始",-1)])]),_:1}),d(t,{type:"warning",onClick:B},{default:v(()=>[...e[10]||(e[10]=[m("暂停",-1)])]),_:1}),d(t,{type:"primary",onClick:re},{default:v(()=>[...e[11]||(e[11]=[m("继续",-1)])]),_:1}),d(t,{type:"danger",onClick:ie},{default:v(()=>[...e[12]||(e[12]=[m("重置",-1)])]),_:1}),d(t,{type:"success",onClick:M,disabled:x.value>=y.value.totalPeriods||n.value==="ended"},{default:v(()=>[...e[13]||(e[13]=[m(" 下一节 ",-1)])]),_:1},8,["disabled"]),n.value==="resting"?(b(),ke(t,{key:0,type:"info",onClick:M},{default:v(()=>[...e[14]||(e[14]=[m(" 提前结束休息 ",-1)])]),_:1})):K("",!0)]),y.value.enable24Seconds&&n.value==="playing"?(b(),w("div",Ie,[e[16]||(e[16]=s("span",{class:"small-label"},"24秒:",-1)),s("span",$e,u(k.value)+"秒",1),d(t,{size:"large",type:"warning",onClick:U,onKeydown:Ce(U,["space"]),style:{color:"#000"},disabled:n.value!=="playing",tabindex:"0"},{default:v(()=>[...e[15]||(e[15]=[m(" 重置24秒 (空格) ",-1)])]),_:1},8,["disabled"])])):K("",!0)]),s("div",Ee,[s("div",{class:"team",style:L({order:C.value?1:2})},[s("div",Fe,[s("img",{src:se,alt:"箭头",style:L({opacity:A.value?1:0})},null,4),s("p",Re,u(r.value.name||"A队"),1)]),s("div",Ue,u(String(h.value).padStart(2,"0")),1),s("div",Ke,u(r.value.players.filter(l=>l.foul>0).length)+" 犯 / "+u($.value)+" 暂停 ",1),s("div",Le,[Q((b(),w("div",Me,[(b(!0),w(Y,null,ee(r.value.players,(l,D)=>(b(),w("button",{key:D,class:ae(["player-btn",{active:g.value===1&&i.value===D}]),tabindex:"0",onClick:ye=>V(1,D),draggable:"true"},[s("div",null,u(l.number),1),s("div",ze,u(l.name||l.number+"号球员"),1),s("div",Je,u(String(l.score||0).padStart(1,"0")),1),l.foul>0?(b(),w("div",je,u(l.foul)+" 犯",1)):K("",!0)],10,Oe))),128))])),[[le(te),{list:o.value.players,canDrag:!0,dragItemClass:"player-btn"}]])])],4),s("div",{class:"team",style:L({order:C.value?2:1})},[s("div",Xe,[s("img",{src:se,alt:"箭头",style:L({opacity:A.value?0:1})},null,4),s("p",Ve,u(o.value.name||"B队"),1)]),s("div",qe,u(String(T.value).padStart(2,"0")),1),s("div",Ge,u(o.value.players.filter(l=>l.foul>0).length)+" 犯 / "+u(E.value)+" 暂停 ",1),s("div",He,[Q((b(),w("div",We,[(b(!0),w(Y,null,ee(o.value.players,(l,D)=>(b(),w("button",{key:D,class:ae(["player-btn",{active:g.value===2&&i.value===D}]),tabindex:"0",onClick:ye=>V(2,D),draggable:"true"},[s("div",null,u(l.number),1),s("div",Qe,u(l.name||l.number+"号球员"),1),s("div",Ye,u(l.score||0),1),l.foul>0?(b(),w("div",ea,u(l.foul)+" 犯",1)):K("",!0)],10,Ze))),128))])),[[le(te),{list:o.value.players,canDrag:!0,dragItemClass:"player-btn"}]])])],4)]),s("div",aa,[d(t,{color:"#4CAF50",onClick:e[0]||(e[0]=l=>N(1)),disabled:n.value==="ended"},{default:v(()=>[...e[18]||(e[18]=[m("1分 (1)",-1)])]),_:1},8,["disabled"]),d(t,{color:"#FF9800",onClick:e[1]||(e[1]=l=>N(2)),disabled:n.value==="ended"},{default:v(()=>[...e[19]||(e[19]=[m("2分 (Enter/2)",-1)])]),_:1},8,["disabled"]),d(t,{color:"#2196F3",onClick:e[2]||(e[2]=l=>N(3)),disabled:n.value==="ended"},{default:v(()=>[...e[20]||(e[20]=[m("3分 (3)",-1)])]),_:1},8,["disabled"]),d(t,{type:"danger",onClick:e[3]||(e[3]=l=>W()),disabled:n.value==="ended"},{default:v(()=>[...e[21]||(e[21]=[m("撤销分数 (Z)",-1)])]),_:1},8,["disabled"]),d(t,{type:"warning",onClick:e[4]||(e[4]=l=>G()),disabled:n.value==="ended"},{default:v(()=>[...e[22]||(e[22]=[m("犯规 (F)",-1)])]),_:1},8,["disabled"]),d(t,{type:"warning",onClick:e[5]||(e[5]=l=>H()),disabled:n.value==="ended"},{default:v(()=>[...e[23]||(e[23]=[m("撤销犯规 (G)",-1)])]),_:1},8,["disabled"]),d(t,{type:"primary",onClick:e[6]||(e[6]=l=>q(1)),disabled:n.value==="ended"},{default:v(()=>[m(u(r.value.name||"A队")+"暂停 ",1)]),_:1},8,["disabled"]),d(t,{type:"primary",onClick:e[7]||(e[7]=l=>q(2)),disabled:n.value==="ended"},{default:v(()=>[m(u(o.value.name||"B队")+"暂停 ",1)]),_:1},8,["disabled"]),d(t,{type:"primary",onClick:me},{default:v(()=>[m(u(P.value?"隐藏":"显示")+"人员面板 ",1)]),_:1}),d(t,{type:"warning",onClick:fe},{default:v(()=>[...e[24]||(e[24]=[m("换边",-1)])]),_:1}),d(t,{color:"#8E24AA",onClick:oe},{default:v(()=>[...e[25]||(e[25]=[m("切换球权",-1)])]),_:1}),d(t,{type:"primary",onClick:pe},{default:v(()=>[...e[26]||(e[26]=[m("打开副屏",-1)])]),_:1}),d(t,{type:"success",onClick:e[8]||(e[8]=l=>ce())},{default:v(()=>[...e[27]||(e[27]=[m("导出Excel数据",-1)])]),_:1}),d(t,{color:"#D32F2F",onClick:de},{default:v(()=>[...e[28]||(e[28]=[m("结束比赛",-1)])]),_:1})])]),_:1})]),_:1})])}}},ua=ge(la,[["__scopeId","data-v-1fa65b6f"]]);export{ua as default};
