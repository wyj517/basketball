import{_ as R,r as u,m as F,h as j,i as q,j as E,c,o as m,k as p,b as t,d as x,F as I,f as L,t as d,l as $}from"./index-D8lsJf-2.js";import{F as C}from"./FlipDigit-DtujmTLC.js";import{T as U}from"./teamPk-CFxXxr1E.js";const V=""+new URL("logo-Bv1Wukfg.png",import.meta.url).href,W={class:"background"},G={key:0,class:"team-info-panel team-a-panel"},H={class:"center-panel"},K={class:"vice-panel"},Q={class:"match-info-container"},X={class:"teams-info"},Y={class:"team-info"},Z={class:"team-logo team-a"},ee=["src"],ae={class:"flip-wrapper",style:{"margin-top":"14px"}},te={class:"period-info"},se={class:"period-number"},le={class:"period-status"},ne={class:"team-info"},oe={class:"team-logo team-b"},ie=["src","alt"],ue={class:"flip-wrapper",style:{"margin-top":"14px"}},me={class:"stats-container"},re={class:"stat-row"},ce={class:"team-stat team-a"},de={class:"team-stat team-b"},ve={class:"stat-row"},fe={class:"team-stat team-a"},pe={class:"team-stat team-b"},_e={key:0,class:"vice-24s-section"},ge={class:"vice-24s"},ye={key:1,class:"vice-rest"},he={class:"rest-text",style:{color:"#49ddfa"}},Be={key:2,class:"vice-end"},Se={key:1,class:"team-info-panel team-b-panel"},Ae={__name:"test",setup(be){const J=q(),l=u(null),i=u({name:"",score:0,players:[]}),n=u({name:"",score:0,players:[]}),b=u(1),_=u(12*60),T=u(22),g=u(0),r=u("playing"),y=u(!0),h=u(0),B=u(0),S=u(0),A=u(0),v=u(!0),O=F(()=>localStorage.getItem("teamALogo")||V),z=F(()=>localStorage.getItem("teamBLogo")||V);function P(o){const e=String(Math.floor(o/60)).padStart(2,"0"),s=String(o%60).padStart(2,"0");return`${e}:${s}`}let w=null,f=null;j(()=>{const o=J.query.data;if(o)try{l.value=JSON.parse(o),l.value.teamA&&(i.value.name=l.value.teamA.name||"",l.value.teamA.score!==void 0&&(i.value.score=l.value.teamA.score),l.value.teamA.players&&(i.value.players=l.value.teamA.players)),l.value.teamB&&(n.value.name=l.value.teamB.name||"",l.value.teamB.score!==void 0&&(n.value.score=l.value.teamB.score),l.value.teamB.players&&(n.value.players=l.value.teamB.players)),l.value.settings&&(_.value=l.value.settings.periodTime*60,y.value=l.value.settings.enable24Seconds||!1),l.value.matchName&&(document.title=l.value.matchName),l.value.showTeamPanels!==void 0&&(v.value=l.value.showTeamPanels)}catch(s){console.error("解析数据失败:",s)}const e=localStorage.getItem("showTeamPanels");e!==null&&(v.value=e==="true"),w=setInterval(()=>{M()},100);try{f=new BroadcastChannel("matchDataChannel"),f.onmessage=s=>{if(s.data.type==="dataUpdated"){const a=s.data.data;a.teamA&&(i.value.name=a.teamA.name||i.value.name,a.teamA.score!==void 0&&(i.value.score=a.teamA.score),a.teamA.players&&(i.value.players=a.teamA.players)),a.teamB&&(n.value.name=a.teamB.name||n.value.name,a.teamB.score!==void 0&&(n.value.score=a.teamB.score),a.teamB.players&&(n.value.players=a.teamB.players)),a.playNumber!==void 0&&(b.value=a.playNumber),a.mainTime!==void 0&&(_.value=a.mainTime),a.smallTime!==void 0&&(T.value=a.smallTime),a.restTime!==void 0&&(g.value=a.restTime),a.gameStatus!==void 0&&(r.value=a.gameStatus),a.settings&&a.settings.enable24Seconds!==void 0&&(y.value=a.settings.enable24Seconds),a.teamAPauses!==void 0&&(h.value=a.teamAPauses),a.teamBPauses!==void 0&&(B.value=a.teamBPauses),a.teamA&&a.teamA.players&&(S.value=a.teamA.players.reduce((k,N)=>k+(N.foul||0),0)),a.teamB&&a.teamB.players&&(A.value=a.teamB.players.reduce((k,N)=>k+(N.foul||0),0)),a.showTeamPanels!==void 0&&(v.value=a.showTeamPanels),l.value=a}else s.data.type==="toggleTeamPanels"&&(v.value=s.data.show)}}catch{console.log("BroadcastChannel not supported")}});function M(){try{const o=localStorage.getItem("matchSyncData");if(o&&o!==JSON.stringify(l.value))try{const e=JSON.parse(o);e.teamA&&(i.value.name=e.teamA.name||i.value.name,e.teamA.score!==void 0&&(i.value.score=e.teamA.score),e.teamA.players&&(i.value.players=e.teamA.players)),e.teamB&&(n.value.name=e.teamB.name||n.value.name,e.teamB.score!==void 0&&(n.value.score=e.teamB.score),e.teamB.players&&(n.value.players=e.teamB.players)),e.playNumber!==void 0&&(b.value=e.playNumber),e.mainTime!==void 0&&(_.value=e.mainTime),e.smallTime!==void 0&&(T.value=e.smallTime),e.restTime!==void 0&&(g.value=e.restTime),e.gameStatus!==void 0&&(r.value=e.gameStatus),e.settings&&e.settings.enable24Seconds!==void 0&&(y.value=e.settings.enable24Seconds),e.teamAPauses!==void 0&&(h.value=e.teamAPauses),e.teamBPauses!==void 0&&(B.value=e.teamBPauses),e.teamA&&e.teamA.players&&(S.value=e.teamA.players.reduce((s,a)=>s+(a.foul||0),0)),e.teamB&&e.teamB.players&&(A.value=e.teamB.players.reduce((s,a)=>s+(a.foul||0),0)),e.showTeamPanels!==void 0&&(v.value=e.showTeamPanels),l.value=e}catch(e){console.error("更新数据失败:",e)}}catch(o){console.error("检查数据更新失败:",o)}}E(()=>{w&&clearInterval(w),f&&(f.close(),f=null)});function D(o){const e=String(o).padStart(2,"0");return console.log(`Formatted score: ${o} -> [${e[0]}, ${e[1]}, ${e[2]}]`),[e[0],e[1]]}return(o,e)=>(m(),c("div",W,[v.value?(m(),c("div",G,[x(U,{"custom-players":i.value.players.map(s=>({id:s.number||"0",name:s.name||"未知",score:s.score||0,foul:s.foul||0})),"team-name":i.value.name||"队伍A"},null,8,["custom-players","team-name"])])):p("",!0),t("div",H,[t("div",K,[e[5]||(e[5]=t("div",{class:"vice-title"},null,-1)),t("div",Q,[t("div",X,[t("div",Y,[t("div",Z,[t("img",{src:O.value,class:"circular-image"},null,8,ee)]),t("div",ae,[(m(!0),c(I,null,L(D(i.value.score),(s,a)=>(m(),$(C,{key:"a"+a,number:s.toString()},null,8,["number"]))),128))])]),t("div",te,[t("div",se,"第"+d(b.value)+"节",1),t("div",le,d(r.value==="resting"?P(g.value):r.value==="ended"?"结束":P(_.value)),1),e[0]||(e[0]=t("div",{class:"VS",style:{position:"relative","font-size":"100px",top:"140px"}}," VS ",-1))]),t("div",ne,[t("div",oe,[t("img",{src:z.value,alt:n.value.name,class:"circular-image"},null,8,ie)]),t("div",ue,[(m(!0),c(I,null,L(D(n.value.score),(s,a)=>(m(),$(C,{key:"b"+a,number:s.toString()},null,8,["number"]))),128))])])]),t("div",me,[t("div",re,[t("div",ce,d(h.value===0?"F":h.value),1),e[1]||(e[1]=t("div",{class:"stat-label"},"暂停",-1)),t("div",de,d(B.value===0?"F":B.value),1)]),t("div",ve,[t("div",fe,d(S.value===0?"F":S.value),1),e[2]||(e[2]=t("div",{class:"stat-label"},"犯规",-1)),t("div",pe,d(A.value===0?"F":A.value),1)])])]),r.value!=="resting"&&r.value!=="ended"&&y.value?(m(),c("div",_e,[e[3]||(e[3]=t("span",{class:"vice-24s-label"},"24秒",-1)),t("span",ge,d(T.value),1)])):p("",!0),r.value==="resting"?(m(),c("div",ye,[t("span",he,"节间休息："+d(P(g.value)),1)])):p("",!0),r.value==="ended"?(m(),c("div",Be,[...e[4]||(e[4]=[t("span",{class:"end-text",style:{color:"#ff6b6b","font-size":"40px","font-weight":"bold"}},"比赛结束",-1)])])):p("",!0)])]),v.value?(m(),c("div",Se,[x(U,{"custom-players":n.value.players.map(s=>({id:s.number||"0",name:s.name||"未知",score:s.score||0,foul:s.foul||0})),"team-name":n.value.name||"队伍B"},null,8,["custom-players","team-name"])])):p("",!0)]))}},ke=R(Ae,[["__scopeId","data-v-f3caca65"]]);export{ke as default};
